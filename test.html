<html>
<head>
    <title>FBP Example</title>
</head>
<body>
    <script type="text/javascript" src="fbp.js"></script>
    <script type="text/javascript">
    /*
     * Define a component.
     * 1st argument is the name of the component.
     *   If the name is an string array, each name will become identical components.
     * 2nd & 3rd arguments are the number of inputs and outputs, respectively.
     * 4th argument is the main task of the component.
     *   The task function has no return values.
     *   The number of arguments is equal to the 2nd argument plus 1, where the last
     *   argument is  the callback function that FBP provides.
     *   The callback function needs to be explicitly called to send the output.
     */
    FBP.component('add', 2, 1, function (x, y, callback) {
        callback(0, x + y);
    });

    FBP.component('mul', 2, 1, function (x, y, callback) {
        
        /*
         * Send output value to the corresponding port.
         * 1st argument, 0, specifies port index.
         * 2nd argument is the output value.
         */
        callback(0, x * y);
    });

    /*
     * Setup a executable graph.
     * 1st argument is the name of the graph.
     * 2nd argument is the configuration block of the graph.
     *   Any starting points, arcs, and ending points should be added here.
     */
    FBP.setup('graph1', function (F) {

        /*
         * Add a starting point for the graph.
         *   Beware the order of the start() calls.
         *   The order will influence the order of input sequence while invoking the graph.
         * 1st argument is the name of the component that accepts the input.
         * 2nd argument is the port index for the component.
         */
        F.start('add', 0);
        F.start('add', 1);
        F.start('mul', 1);

        /*
         * Add an arc for the graph.
         * 1st and 3rd arguments specify the direction of the arc.
         * 2nd and 4th arguments specify the port index for the 1st and 3rd components respectively.
         */
        F.arc('add', 0, 'mul', 0);

        /*
         * Add an ending point for the graph.
         *   Note that the ending point might not be needed for a graph,
         *   only if you do not care the output of the result.
         *   It depends on your graph design.
         * 1st argument is the name of the component that links to the output.
         * 2nd argument is the port index for the component.
         */
        F.end('mul', 0); // set 1st output of 'mul' as an end
    });

    /*
     * Invoke your graph.
     * FBP.graph(name) is the graph getter.
     * The arguments for invoke() include first and second parts:
     *   1st part is a series of inputs that corresponds to each input ports.
     *     Note that the input order must corresponds to the order of start() calls.
     *   2nd part is a callback function that is called when
     *     (1) The execution failed. In this case, the err argument specifies reasons of failure.
     *     (2) The execution succeeded, where the err argument is null, and the result argument is the execution result.
     */
    FBP.graph('graph1').invoke(1, 2, 3, function (err, result) {
        console.log(result); // should be (1 + 2) * 3 = 9
    });
    </script>
</body>
</html>