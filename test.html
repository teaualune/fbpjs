<html>
<head>
    <title>FBP Example</title>
</head>
<body>
    <script type="text/javascript" src="fbp.js"></script>
    <script type="text/javascript">
    /*
     * Define a component.
     * 1st argument is the name of the component.
     * 2nd & 3rd arguments are the number of inputs and outputs, respectively.
     * 4th argument is the main task of the component.
     *   The task function has no return values.
     *   The number of arguments is equal to the 2nd argument plus 1, where the last
     *   argument is  the callback function that FBP provides.
     *   The callback function needs to be explicitly called to send the output.
     */
    FBP.component('add', ['x', 'y', function (x, y, callback) {
        callback('output', x + y);
    }]);

    /*
     * Another way to define a component:
     *   use a configuration object as the 1st argument.
     */
    FBP.component({
        // Required; this value is treated as same as the 1st input of the previous version
        name: 'mul'
    }, ['x', 'y', function (x, y, callback) {
        
        /*
         * Send output value to the corresponding port.
         * 1st argument, 0, specifies port index.
         * 2nd argument is the output value.
         */
        callback('output', x * y);
    }]);

    /*
     * Setup a executable graph.
     * 1st argument is the name of the graph.
     * 2nd argument is the configuration block of the graph.
     *   Any starting points, arcs, and ending points should be added here.
     */
    FBP.setup('graph1', function (F) {

        /*
         * Add a starting point for the graph.
         * 1st argument is the name of the component that accepts the input.
         * 2nd argument is the port index for the component.
         */
        F.init('add', 'x');
        F.init('add', 'y');
        F.init('mul', 'y');

        /*
         * Connect an out port toward another in port.
         * 1st and 3rd arguments specify the direction of the connection.
         * 2nd and 4th arguments specify the port index for the 1st and 3rd components respectively.
         */
        F.connect('add', 'output', 'mul', 'x');

        /*
         * Add an ending point for the graph.
         *   Note that the ending point might not be needed for a graph,
         *   only if you do not care the output of the result.
         *   It depends on your graph design.
         * 1st argument is the name of the component that links to the output.
         * 2nd argument is the port index for the component.
         */
        F.end('mul', 'output'); // set 1st output of 'mul' as an end
    });

    /*
     * Invoke your graph.
     * FBP.graph(name) is the graph getter.
     * The arguments for go() include first and second parts:
     *   1st part is a series of inputs that corresponds to each input ports.
     *   2nd part is a callback function that is called when
     *     (1) The execution failed. In this case, the err argument specifies reasons of failure.
     *     (2) The execution succeeded, where the err argument is null, and the result argument is the execution result.
     */
    FBP.graph('graph1').go({
        'add.x': 1,
        'add.y': 2,
        'mul.y': 3
    }, function (err, result) {
        console.log(result.outputs['mul.output']); // should be 9
    });
    </script>
</body>
</html>