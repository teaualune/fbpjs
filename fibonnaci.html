<html>
<head>
    <title>FBP example - Fibonacci</title>
</head>
<body>
    <script type="text/javascript" src="fbp.js"></script>
    <script type="text/javascript">

    FBP.component({
        name: 'fib',
        state: {
            i: 2
        }
    }, ['begin', function (config, callback) {
        var a2 = config.a0 + config.a1;
        if (config.n === 0) {
            callback('end', config.a0);
        } else if (config.n === 1) {
            callback('end', config.a1);
        } else {
            if (this.i === config.n) {
                callback('end', a2);
            } else {
                this.i = this.i + 1;
                callback('next', {
                    a0: config.a1,
                    a1: a2,
                    n: config.n
                });
            }
        }
    }]);

    FBP.setup('fibonacci', function (F) {
        F.init('fib', 'begin');
        F.end('fib', 'end');
        F.connect('fib', 'next', 'fib', 'begin');
    });

    FBP.graph('fibonacci').go({
        'fib.begin': {
            a0: 1,
            a1: 1,
            n: 6
        }
    }, function (err, result) {
        console.log(result.outputs['fib.end']);
    });

    </script>
</body>
</html>